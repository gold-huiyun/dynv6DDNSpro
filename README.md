# dynv6DDNSpro-----dynv6 DDNS 自动更新脚本
 适合青龙面板等多场景需求的dynv6 DDNS 脚本使，帮助您顺利部署和使用动态域名解析工具


![Python](https://img.shields.io/badge/Python-3.6%2B-blue)
![License](https://img.shields.io/badge/License-MIT-green.svg)

专为 **青龙面板** 设计的动态域名解析工具，支持 **IPv4/IPv6 双栈**，具备智能 IP 获取、多 API 容错与实时通知功能。

该自动化脚本帮助您轻松管理在 https://dynv6.com 上的免费域名，确保其 DNS 记录始终指向您设备的最新公网 IP 地址（包括 IPv4 和 IPv6），特别适用于 **家庭网络、NAS 或拥有动态公网 IP 的服务器**。

---

## ✨ 核心特性

- 🔄 **双栈 IP 支持**  
  可单独或同时为域名更新 IPv4 (A 记录) 与 IPv6 (AAAA 记录)。

- 🌐 **灵活的 IP 获取**  
  - **公网 API 模式**：通过多个容错 API 服务查询您的出口公网 IP。  
  - **网卡读取模式**：直接从指定的网络接口读取已配置的 IP 地址，适合多网卡或特殊网络环境。

- 🔔 **青龙面板深度集成**  
  原生支持青龙面板的 `notify` 通知模块，执行结果会通过您配置的渠道（如钉钉、微信等）实时推送。

- ⚙️ **高度可配置**  
  所有选项均通过环境变量控制，无需修改代码，灵活适配各种需求。

- 📊 **智能日志与容错**  
  详细的运行日志输出，IP 获取具备多重回退机制，确保服务稳定可靠。

---

## 📋 环境变量配置

在运行脚本前，您需要设置以下环境变量。在青龙面板中，可以在「环境变量」或脚本的「配置」中添加它们。

| 变量名                  | 必填 | 默认值    | 描述与示例 |
|-------------------------|------|-----------|------------|
| `DYNV6_DOMAIN`         | 是   | -         | 您在 dynv6 上设置的完整域名。例如：`huiyun.v6.rocks` |
| `DYNV6_TOKEN`          | 是   | -         | 您的 dynv6 API Token（在网站上的 APIs 或 HTTP Tokens 页面获取） |
| `DYNV6_IPV4`           | 否   | `true`    | 是否启用 IPv4 地址更新。设为 `false` 可禁用。 |
| `DYNV6_IPV6`           | 否   | `true`    | 是否启用 IPv6 地址更新。设为 `false` 可禁用。 |
| `DYNV6_IP_SOURCE`      | 否   | `public_api` | IP 地址获取方式。可选：`public_api`(推荐) 或 `network_interface` |
| `DYNV6_INTERFACE_MAC`  | 条件必填 | -       | 当 `IP_SOURCE=network_interface` 时，指定目标网卡的 MAC 地址。例如：`AB:88:88:88:88:88` |
| `DYNV6_INTERFACE_NAME` | 条件必填 | -       | 网卡名称，可作为 MAC 地址的替代。例如：`eth0` 或 `wlan0` |
| `DYNV6_CHECK_INTERVAL` | 否   | `60`      | 在连续运行模式下，每次检查的间隔时间（秒）。 |
| `DYNV6_CONTINUOUS`     | 否   | `false`   | 是否启用连续运行模式。设为 `true` 后脚本将循环运行，适合非青龙面板的常驻服务场景。 |

> **提示**：对于绝大多数用户，使用默认的 `public_api` 模式即可。只有当您需要指定使用某块特定网卡的 IP 时，才需要使用 `network_interface` 模式，并正确设置 `DYNV6_INTERFACE_MAC` 或 `DYNV6_INTERFACE_NAME`。

---

## 🚀 在青龙面板中快速部署

1. **上传脚本**  
   - 登录青龙面板，进入「脚本管理」。  
   - 创建一个新文件，例如 `dynv6_ddns.py`。  
   - 将完整的脚本代码复制粘贴到文件中并保存。

2. **配置环境变量**  
   - 在青龙面板的「环境变量」或该脚本的「配置」中，添加上述表格中提到的必要变量，至少包括 `DYNV6_DOMAIN` 和 `DYNV6_TOKEN`。

3. **创建定时任务**  
   - 进入「定时任务」页面，点击「新建任务」。  
   - **任务名称**：填写一个易于识别的名称，如 `更新Dynv6 DDNS`。  
   - **命令**：选择 `task`，命令内容填写：  
     ```bash
     python3 /ql/scripts/dynv6_ddns.py
     ```  
     （请根据您的脚本实际存放路径调整）  
   - **定时规则**：设置一个 Cron 表达式。例如：  
     - `*/5 * * * *`：每 5 分钟运行一次（推荐）。  
     - `0 */1 * * *`：每小时运行一次。  
   - 点击「确定」保存任务。

4. **测试运行**  
   - 保存后，在定时任务列表中找到该任务，点击右侧的「运行」按钮。  
   - 查看「日志」输出，确认脚本是否执行成功。

---

## 🖥️ 通用系统使用方法（非青龙面板）

此脚本同样可以在任何安装有 **Python 3.6+** 环境的 Linux 或 Windows 系统上运行。

- **安装依赖**：
  ```bash
  pip install requests
  ```

- **设置环境变量**：
  - Linux/macOS：
    ```bash
    export DYNV6_TOKEN="your_token"
    ```
    或在 `~/.bashrc` / `~/.zshrc` 中添加。
  - Windows：
    在「系统属性」→「环境变量」中设置，或命令行：
    ```cmd
    set DYNV6_TOKEN=your_token
    ```

- **运行脚本**：
  ```bash
  python3 dynv6_ddns.py
  ```

- **设置为常驻服务（可选）**：
  - Linux：使用 `systemd` 创建服务单元或配置 `crontab` 定时任务。  
  - Windows：使用 **NSSM** 工具将脚本注册为系统服务，实现开机自启。

---

## 🔧 故障排除与常见问题

- ❌ **脚本执行失败，日志显示“无法导入青龙面板通知模块”**  
  **原因**：脚本未在青龙面板环境中运行。  
  **解决**：确保在青龙面板的定时任务中正确配置和执行脚本。如果在外部环境测试，此错误可忽略。

- ❌ **IP 地址获取为 ::1 或 127.0.0.1 等本地地址**  
  **原因**：通常发生在使用“网卡方式”时，脚本未能正确识别公网 IP。  
  **解决**：  
    - 检查 `DYNV6_INTERFACE_MAC` 或 `DYNV6_INTERFACE_NAME` 是否正确。  
    - 尝试切换为 `public_api` 模式。

- ❌ **DNS 更新失败，返回 HTTP 4xx 错误**  
  **原因**：认证或参数错误。  
  **解决**：  
    - 检查 `DYNV6_DOMAIN` 和 `DYNV6_TOKEN` 是否正确。  
    - 确认 Token 是否拥有操作指定域名的权限。

- ❌ **收不到青龙面板的通知**  
  **解决**：确保已在青龙面板的「通知设置」中正确配置通知渠道。

---

## 💎 
- **日志是最好的朋友**：脚本会输出详细日志，可在青龙面板的定时任务日志中查看。

---

如果这个项目对您有帮助，请不吝 **点个 Star ⭐**！  
如有问题或建议，欢迎提交 **Issue** 或 **Pull Request**。
